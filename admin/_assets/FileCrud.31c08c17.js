let e=document.createElement("style");e.innerHTML=".loadMoreWrap[data-v-0d0beee0]{margin-bottom:50px}[data-v-0d0beee0] .collapse-container__body{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}[data-v-0d0beee0] .collapse-container__body form{max-width:880px;-webkit-box-flex:1;-ms-flex:1;flex:1;margin-right:100px}[data-v-0d0beee0] .collapse-container__body button{-webkit-box-flex:0;-ms-flex:0;flex:0}",document.head.appendChild(e);import{v as t,m as a,aP as i,d as l,h as s,M as r,i as o,c as n,l as c,bm as d,r as p,o as u,p as b,w as m,q as f,a as h,b as g,z as y,s as v,aE as w,ad as D,ae as j,x,y as O}from"./index.cefb3244.js";import{C as S}from"./index.e7ff9b58.js";import{B as _,u as k}from"./index.47a8bedc.js";import{s as F,c as R}from"./FileTree.5a6a340d.js";import L from"./Dialog.83f653b3.js";import C from"./SourceList.f1b793f5.js";import{r as P,d as T,a as $,b as E,u as z,g as M,e as A,s as B,f as H,h as I}from"./upload.2162c831.js";import{g as q,u as W}from"./useTable.58c02158.js";import{s as V}from"./useTable.92e68e9b.js";import"./index.5213a239.js";import"./index.21a20b5a.js";import"./useWindowSizeFn.6a91d172.js";import"./domUtils.a209b89e.js";import"./index.37892b32.js";import"./index.172950c5.js";import"./_baseDifference.8d58a474.js";import"./useCopyToClipboard.5f1ed96b.js";import"./CheckOutlined.5f5d8f8a.js";import"./useFullScreen.a1ba7702.js";import"./zh_CN.0242bd16.js";var G={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};function N(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var U=function(e,l){var s=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},i=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),i.forEach((function(t){N(e,t,a[t])}))}return e}({},e,l.attrs);return t(i,a(s,{icon:G}),null)};U.displayName="DeleteOutlined",U.inheritAttrs=!1;var J=U,K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"};function Q(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var X=function(e,l){var s=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},i=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),i.forEach((function(t){Q(e,t,a[t])}))}return e}({},e,l.attrs);return t(i,a(s,{icon:K}),null)};X.displayName="RollbackOutlined",X.inheritAttrs=!1;var Y=X;const{createWarningModal:Z,createConfirm:ee}=c();var te=l({props:["type","title","maxSize","accept"],components:{BasicForm:_,CollapseContainer:S,FileTree:F,Dialog:L,BasicTable:V,RollbackOutlined:Y,DeleteOutlined:J,SourceList:C},data:()=>({isRecycle:0}),methods:{loadMore(){this.sendData.page+1<this.totalPage&&this.sendData.page++,this.reloadFileList(!1)},batchRecover(){const e=this.$refs.SourceList.getSelect(),t=this;e.length?ee({iconType:"warning",title:`确认批量恢复选中的${this.title}？`,onOk(){P(t.type,{ids:e}).then((e=>{t.reloadFileList()}))}}):Z({content:`请选择需要恢复的${this.title}`})},getDeleteData(){this.isRecycle=this.isRecycle?0:1,this.sendData.isDelete=this.isRecycle,this.reloadFileList()},batchSubmit(){const e=this.$refs.SourceList.getSelect(),t=this;e.length?ee({iconType:"warning",title:`确认批量${this.isRecycle?"清空":"删除"}选中的${this.title}？`,onOk(){T(t.type,{ids:e,isClear:t.isRecycle}).then((e=>{t.reloadFileList()}))}}):Z({content:`请选择需要删除的${this.title}`})},getCurrentList(e){const t=/file/.test(e.id),a=t?e.parent_id:e.id;this.setFieldsValue({folder_id:a}),t?this.showFileList=[{path:e.path,id:e.realId,name:e.name,title:e.title}]:(this.sendData.page=0,this.sendData.folder_id=a,this.reloadFileList())},handleSubmit(e){$(this.type,e).then((e=>{e.error_code||(this.resetFields(),this.setFieldsValue({folder_id:this.sendData.folder_id})),this.reloadFileList()}))}},setup(e,t){const a={fetchSetting:{listField:null},pagination:!1,api:t=>A({...t,type:e.type}),title:"分组"},i=s(!1);r("schemas",q([{label:"父类ID",field:"parent_id",width:120,disabled:!0,rules:[{required:!0,message:"请输入父类ID",type:"number"}]},{label:"类型",field:"type",component:"RadioGroup",componentProps:{options:[{label:"图片",value:"img"},{label:"文本",value:"txt"},{label:"音频",value:"audio"},{label:"视频",value:"video"}]},disabled:!0,rules:[{required:!0,message:"请输入文件类型"}]},{label:"文件夹名称",field:"name",rules:[{required:!0,message:"请输入文件夹名称"}]},{label:"文件夹描述",field:"description"}]));const l=o({id:null,initForm:{parent_id:0,type:e.type},title:"新增"}),c={rowSaveApi:B,rowEditApi:H,rowDeleteApi:t=>I(t,e.type)},p=s(null),u=s(null),b=s(null),m=s(!1),f=s(!1),h=o({page:0,count:30,folder_id:null,isDelete:0}),g=d();function y(t=!0){t&&(h.page=0),m.value=!0;const a=g.refs.SourceList;a&&a.resetSelect(),M(e.type,h).then((e=>{!h.page&&(p.value=[]),u.value=e.total_page,m.value=!1,p.value=R(p.value,e.items.map((e=>({parent_id:e.folder_id,name:e.path.split("/").pop(),isLeaf:!0,title:e.title,realId:e.id,id:"file_"+e.id,key:"file_"+e.id,path:e.path})))),b.value=p.value.map((e=>({path:e.path,id:e.realId,name:e.name,title:e.title})))})).catch((()=>{m.value=!1}))}r("sendData",h),y();const[{registerTable:v,isInit:w,getDataSource:D},{registerDialog:j},{rowDelete:x,rowSave:O,rowEdit:S,rowAdd:_}]=W({...a,...c,relyObject:l}),F=n((()=>w()&&D())),L=n((()=>{const t=w()&&D()||[];return[{field:"paths",component:"Upload",label:`${e.title}上传`,colProps:{span:8},rules:[{required:!0,message:`请选择${e.title}文件上传`}],componentProps:{maxSize:e.maxSize,accept:i.value?[]:e.accept,uploadParams:{data:{type:e.type}},api:f.value?E:z}},{field:"folder_id",colProps:{span:8},rules:[{required:!0,message:`请选择${e.title}所属文件分类`,type:"number"}],component:"Select",componentProps:{options:t.map((e=>({label:e.name,value:e.id})))},disabled:!0,label:`${e.title}分类`}]})),[C,{setFieldsValue:P,resetFields:T}]=k({labelWidth:130,schemas:L,actionColOptions:{span:8},resetButtonOptions:{text:"重新上传"},submitButtonOptions:{text:"提交文件"}});return{sendData:h,leafData:p,bigfile:f,loading:m,totalPage:u,fileExpand:i,showFileList:b,reloadFileList:y,register:C,setFieldsValue:P,resetFields:T,registerTable:v,treeData:F,registerDialog:j,rowDelete:x,rowSave:O,rowEdit:S,rowAdd:_,relyObject:l}}});const ae={class:"imgWrapper"},ie=(e=>(x("data-v-0d0beee0"),e=e(),O(),e))((()=>f("span",null,"类型扩展",-1))),le=y("批量恢复"),se={key:0},re=y(" 返回 "),oe={key:1},ne=y(" 回收站 "),ce={class:"loadMoreWrap"},de=y("加载更多...");te.render=function(e,a,i,l,s,r){const o=p("a-switch"),n=p("a-tooltip"),c=p("BasicForm"),d=p("a-button"),x=p("RollbackOutlined"),O=p("DeleteOutlined"),S=p("CollapseContainer"),_=p("a-alert"),k=p("SourceList"),F=p("FileTree"),R=p("Dialog"),L=p("BasicTable");return u(),b("div",ae,[t(S,{title:e.title+"上传"},{default:m((()=>[t(n,{placement:"top"},{title:m((()=>[ie])),default:m((()=>[t(o,{"checked-children":"开","un-checked-children":"关",checked:e.fileExpand,"onUpdate:checked":a[0]||(a[0]=t=>e.fileExpand=t)},null,8,["checked"])])),_:1}),t(c,{onRegister:e.register,onSubmit:e.handleSubmit},null,8,["onRegister","onSubmit"]),f("div",null,[e.isRecycle?(u(),h(d,{key:0,class:"mr_btn",type:"primary",onClick:a[1]||(a[1]=t=>e.batchRecover())},{default:m((()=>[le])),_:1})):g("",!0),t(d,{class:"mr_btn",type:"danger",onClick:a[2]||(a[2]=t=>e.batchSubmit())},{default:m((()=>[y("批量"+v(e.isRecycle?"清空":"删除"),1)])),_:1}),t(d,{type:e.isRecycle?"primary":"default",onClick:a[3]||(a[3]=t=>e.getDeleteData())},{default:m((()=>[e.isRecycle?(u(),b("div",se,[t(x),re])):(u(),b("div",oe,[t(O),ne]))])),_:1},8,["type"])])])),_:1},8,["title"]),t(F,{leafData:e.leafData,treeData:e.treeData,onCurrentClass:e.getCurrentList,onRowDelete:e.rowDelete,onRowAdd:a[5]||(a[5]=t=>e.rowAdd(e.$refs.Dialog,t)),onRowEdit:a[6]||(a[6]=t=>e.rowEdit(e.$refs.Dialog,Object.assign(e.relyObject.initForm,t)))},{default:m((()=>[e.leafData?(u(),b(w,{key:0},[e.isRecycle?(u(),h(_,{key:0,message:"当前展示内容为回收站内容",banner:""})):g("",!0),t(k,{type:e.type,ref:"SourceList",gapGroup:e.isRecycle?e.showFileList.length:6,showFileList:e.showFileList},null,8,["type","gapGroup","showFileList"]),D(f("div",ce,[t(d,{loading:e.loading,size:"large",block:"",onClick:a[4]||(a[4]=t=>e.loadMore())},{default:m((()=>[de])),_:1},8,["loading"])],512),[[j,e.totalPage>e.sendData.page+1]])],64)):g("",!0)])),_:1},8,["leafData","treeData","onCurrentClass","onRowDelete"]),t(R,{ref:"Dialog",onRowSave:e.rowSave,title:e.relyObject.title,onRegister:e.registerDialog},null,8,["onRowSave","title","onRegister"]),t(L,{isFake:!0,onRegister:e.registerTable},null,8,["onRegister"])])},te.__scopeId="data-v-0d0beee0";export{te as default};
